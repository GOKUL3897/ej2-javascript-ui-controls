import { DocumentEditor } from '../../../src/document-editor/document-editor';
import { createElement } from '@syncfusion/ej2-base';
import { Editor,ParagraphWidget } from '../../../src/index';
import { TestHelper } from '../../test-helper.spec';
import { Selection } from '../../../src/index';
import { EditorHistory } from '../../../src/document-editor/implementation/editor-history/editor-history';
import { LineWidget, TextElementBox } from '../../../src';


describe("Footnote with keep with next", () => {
    let editor: DocumentEditor = undefined;
    beforeAll(() => {
        document.body.innerHTML = '';
        let ele: HTMLElement = createElement('div', { id: 'container' });
        document.body.appendChild(ele);
        DocumentEditor.Inject(Editor, Selection, EditorHistory);
        editor = new DocumentEditor({ enableEditor: true, isReadOnly: false, enableEditorHistory: true });
        (editor.documentHelper as any).containerCanvasIn = TestHelper.containerCanvas;
        (editor.documentHelper as any).selectionCanvasIn = TestHelper.selectionCanvas;
        (editor.documentHelper.render as any).pageCanvasIn = TestHelper.pageCanvas;
        (editor.documentHelper.render as any).selectionCanvasIn = TestHelper.pageSelectionCanvas;
        editor.appendTo('#container');
    });
    afterAll((done) => {
        editor.destroy();
        document.body.removeChild(document.getElementById('container'));
        editor = undefined;
        document.body.innerHTML = '';
        setTimeout(() => {
            done();
        }, 750);
    });
    it("Footnote move to next page validation", () => {
        console.log("Footnote move to next page validation");
        editor.open(getDocument());
        expect(editor.documentHelper.pages.length).toBe(3);
        expect(editor.documentHelper.pages[1].footnoteWidget.childWidgets.length).toBe(4);

        expect((((editor.documentHelper.pages[1].footnoteWidget.childWidgets[1] as ParagraphWidget).childWidgets[0] as LineWidget).children.pop() as TextElementBox).text).toBe(" First");
        expect((((editor.documentHelper.pages[1].footnoteWidget.childWidgets[2] as ParagraphWidget).childWidgets[0] as LineWidget).children.pop() as TextElementBox).text).toBe(" Second");
        expect((((editor.documentHelper.pages[1].footnoteWidget.childWidgets[3] as ParagraphWidget).childWidgets[0] as LineWidget).children.pop() as TextElementBox).text).toBe(" Third");
    });

});

function getDocument() : string {
    return '{"sections":[{"sectionFormat":{"pageWidth":612,"pageHeight":792,"leftMargin":72,"rightMargin":72,"topMargin":72,"bottomMargin":72,"differentFirstPage":false,"differentOddAndEvenPages":false,"headerDistance":36,"footerDistance":36,"bidi":false},"blocks":[{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and composite bicycles to North American, European and Asian commercial markets. While its base "},{"characterFormat":{"fontColor":"empty"},"text":"operation is located in Bothell, Washington with 290 employees, several regional sales teams are located "},{"characterFormat":{"fontColor":"empty"},"text":"throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitio"},{"footnoteType":"Footnote","characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"blocks":[{"paragraphFormat":{"styleName":"Footnote Text","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"text":"1"},{"characterFormat":{"fontColor":"empty"},"text":" First"}]}],"symbolCode":0},{"characterFormat":{"fontColor":"empty"},"text":"us company on which the AdventureWorks sample "},{"characterFormat":{"fontColor":"empty"},"text":"databases are based, is a large, multinational manufacturing company. The company manufactures and "},{"characterFormat":{"fontColor":"empty"},"text":"sells metal and composite bicycles to North American, European and Asian commercial markets. While "},{"characterFormat":{"fontColor":"empty"},"text":"its base operation is located in Bothell, Washington with 290 employees, several regional sales teams are "},{"characterFormat":{"fontColor":"empty"},"text":"located throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitiou"},{"footnoteType":"Footnote","characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"blocks":[{"paragraphFormat":{"styleName":"Footnote Text","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"text":"2"},{"characterFormat":{"fontColor":"empty"},"text":" Second"}]}],"symbolCode":0},{"characterFormat":{"fontColor":"empty"},"text":"s company on which the AdventureWorks sample "},{"characterFormat":{"fontColor":"empty"},"text":"databases are based, is a large, multinational manufacturing company. The company manufactures and "},{"characterFormat":{"fontColor":"empty"},"text":"sells metal and composite bicycles to North American, European and Asian commercial markets. While "},{"characterFormat":{"fontColor":"empty"},"text":"its base operation is located in Bothell, Washington with 290 employees, several regional sales teams are "},{"characterFormat":{"fontColor":"empty"},"text":"located throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitiou"},{"footnoteType":"Footnote","characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"blocks":[{"paragraphFormat":{"styleName":"Footnote Text","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty","styleName":"Footnote Reference"},"text":"3"},{"characterFormat":{"fontColor":"empty"},"text":" Third"}]}],"symbolCode":0},{"characterFormat":{"fontColor":"empty"},"text":"s company on which the AdventureWorks sample "},{"characterFormat":{"fontColor":"empty"},"text":"databases are based, is a large, multinational manufacturing company. The company manufactures and "},{"characterFormat":{"fontColor":"empty"},"text":"sells metal and composite bicycles to North American, European and Asian commercial markets. While "},{"characterFormat":{"fontColor":"empty"},"text":"its base operation is located in Bothell, Washington with 290 employees, several regional sales teams are "},{"characterFormat":{"fontColor":"empty"},"text":"located throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and composite bicycles to North American, European and Asian commercial markets. While its base "},{"characterFormat":{"fontColor":"empty"},"text":"operation is located in Bothell, Washington with 290 employees, several regional sales teams are located "},{"characterFormat":{"fontColor":"empty"},"text":"throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"afterSpacing":0,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and Washington with 290 employees, several regional sales teams are located throughout their market "},{"characterFormat":{"fontColor":"empty"},"text":"base."}]},{"paragraphFormat":{"firstLineIndent":36,"afterSpacing":0,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and, Washington with 290 employees, several regional sales teams are located throughout their market "},{"characterFormat":{"fontColor":"empty"},"text":"base."}]},{"paragraphFormat":{"afterSpacing":0,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontColor":"empty"},"inlines":[]},{"paragraphFormat":{"firstLineIndent":36,"afterSpacing":0,"styleName":"Normal","listFormat":{},"keepLinesTogether":true,"keepWithNext":true},"characterFormat":{"fontSize":12,"fontColor":"empty","fontSizeBidi":12},"inlines":[{"characterFormat":{"fontSize":12,"fontColor":"empty","fontSizeBidi":12},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample "},{"characterFormat":{"fontSize":12,"fontColor":"empty","fontSizeBidi":12},"text":"databases are based, is a to North American, European and Asian commercial markets. While its "},{"characterFormat":{"fontSize":12,"fontColor":"empty","fontSizeBidi":12},"text":"base operation is located in Bothell, Washington with 290 employees, several regional sales "},{"characterFormat":{"fontSize":12,"fontColor":"empty","fontSizeBidi":12},"text":"teams are located throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and composite bicycles to North American, European and Asian commercial markets. While its base "},{"characterFormat":{"fontColor":"empty"},"text":"operation is located in Bothell, Washington with 290 employees, several regional sales teams are located "},{"characterFormat":{"fontColor":"empty"},"text":"throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and "},{"characterFormat":{"fontColor":"empty"},"text":"sells metal and composite bicycles to North American, European and Asian commercial markets. While "},{"characterFormat":{"fontColor":"empty"},"text":"its base operation is located in Bothell, Washington with 290 employees, several regional sales teams are "},{"characterFormat":{"fontColor":"empty"},"text":"located throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and composite bicycles to North American, European and Asian commercial markets. While its base "},{"characterFormat":{"fontColor":"empty"},"text":"operation is located in Bothell, Washington with 290 employees, several regional sales teams are located "},{"characterFormat":{"fontColor":"empty"},"text":"throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"Adventure Works Cycles, the fictitious company on which the AdventureWorks sample databases "},{"characterFormat":{"fontColor":"empty"},"text":"are based, is a large, multinational manufacturing company. The company manufactures and sells metal "},{"characterFormat":{"fontColor":"empty"},"text":"and composite bicycles to North American, European and Asian commercial markets. While its base "},{"characterFormat":{"fontColor":"empty"},"text":"operation is located in Bothell, Washington with 290 employees, several regional sales teams are located "},{"characterFormat":{"fontColor":"empty"},"text":"throughout their market base."}]},{"paragraphFormat":{"firstLineIndent":36,"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[]},{"paragraphFormat":{"styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[]}],"headersFooters":{"header":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"footer":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"evenHeader":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"evenFooter":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"firstPageHeader":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"firstPageFooter":{"blocks":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]}}}],"characterFormat":{"bold":false,"italic":false,"fontSize":11,"fontFamily":"Calibri","underline":"None","strikethrough":"None","baselineAlignment":"Normal","highlightColor":"NoColor","fontColor":"empty","boldBidi":false,"italicBidi":false,"fontSizeBidi":11,"fontFamilyBidi":"Calibri","allCaps":false},"paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":0,"afterSpacing":8,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","listFormat":{},"bidi":false,"keepLinesTogether":false,"keepWithNext":false},"defaultTabWidth":36,"trackChanges":false,"enforcement":false,"hashValue":"","saltValue":"","formatting":false,"protectionType":"NoProtection","dontUseHTMLParagraphAutoSpacing":false,"formFieldShading":true,"compatibilityMode":"Word2013","styles":[{"name":"Normal","type":"Paragraph","paragraphFormat":{"listFormat":{}},"characterFormat":{"fontColor":"empty"},"next":"Normal"},{"name":"Default Paragraph Font","type":"Character","characterFormat":{"fontColor":"empty"}},{"name":"Footnote Text","type":"Paragraph","paragraphFormat":{"afterSpacing":0,"lineSpacing":1,"lineSpacingType":"Multiple","listFormat":{}},"characterFormat":{"fontSize":10,"fontColor":"empty","fontSizeBidi":10},"basedOn":"Normal","link":"Footnote Text Char","next":"Footnote Text"},{"name":"Footnote Text Char","type":"Character","characterFormat":{"fontSize":10,"fontColor":"empty","fontSizeBidi":10},"basedOn":"Default Paragraph Font"},{"name":"Footnote Reference","type":"Character","characterFormat":{"baselineAlignment":"Superscript","fontColor":"empty"},"basedOn":"Default Paragraph Font"},{"name":"Heading 1","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":12,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level1","listFormat":{}},"characterFormat":{"fontSize":16,"fontFamily":"Calibri Light","fontColor":"#2F5496","fontSizeBidi":16,"fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 1 Char","next":"Normal"},{"name":"Heading 1 Char","type":"Character","characterFormat":{"fontSize":16,"fontFamily":"Calibri Light","fontColor":"#2F5496","fontSizeBidi":16,"fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"},{"name":"Heading 2","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":2,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level2","listFormat":{}},"characterFormat":{"fontSize":13,"fontFamily":"Calibri Light","fontColor":"#2F5496","fontSizeBidi":13,"fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 2 Char","next":"Normal"},{"name":"Heading 2 Char","type":"Character","characterFormat":{"fontSize":13,"fontFamily":"Calibri Light","fontColor":"#2F5496","fontSizeBidi":13,"fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"},{"name":"Heading 3","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":2,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level3","listFormat":{}},"characterFormat":{"fontSize":12,"fontFamily":"Calibri Light","fontColor":"#1F3763","fontSizeBidi":12,"fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 3 Char","next":"Normal"},{"name":"Heading 3 Char","type":"Character","characterFormat":{"fontSize":12,"fontFamily":"Calibri Light","fontColor":"#1F3763","fontSizeBidi":12,"fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"},{"name":"Heading 4","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":2,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level4","listFormat":{}},"characterFormat":{"italic":true,"fontFamily":"Calibri Light","fontColor":"#2F5496","italicBidi":true,"fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 4 Char","next":"Normal"},{"name":"Heading 4 Char","type":"Character","characterFormat":{"italic":true,"fontFamily":"Calibri Light","fontColor":"#2F5496","italicBidi":true,"fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"},{"name":"Heading 5","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":2,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level5","listFormat":{}},"characterFormat":{"fontFamily":"Calibri Light","fontColor":"#2F5496","fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 5 Char","next":"Normal"},{"name":"Heading 5 Char","type":"Character","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#2F5496","fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"},{"name":"Heading 6","type":"Paragraph","paragraphFormat":{"leftIndent":0,"rightIndent":0,"firstLineIndent":0,"textAlignment":"Left","beforeSpacing":2,"afterSpacing":0,"lineSpacing":1.0791666507720947,"lineSpacingType":"Multiple","outlineLevel":"Level6","listFormat":{}},"characterFormat":{"fontFamily":"Calibri Light","fontColor":"#1F3763","fontFamilyBidi":"Calibri Light"},"basedOn":"Normal","link":"Heading 6 Char","next":"Normal"},{"name":"Heading 6 Char","type":"Character","characterFormat":{"fontFamily":"Calibri Light","fontColor":"#1F3763","fontFamilyBidi":"Calibri Light"},"basedOn":"Default Paragraph Font"}],"lists":[],"abstractLists":[],"comments":[],"revisions":[],"customXml":[],"footnotes":{"separator":[{"paragraphFormat":{"afterSpacing":0,"lineSpacing":1,"lineSpacingType":"Multiple","styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"\\u0003"}]}],"continuationSeparator":[{"paragraphFormat":{"afterSpacing":0,"lineSpacing":1,"lineSpacingType":"Multiple","styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"\\u0004"}]}],"continuationNotice":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]},"endnotes":{"separator":[{"paragraphFormat":{"afterSpacing":0,"lineSpacing":1,"lineSpacingType":"Multiple","styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"\\u0003"}]}],"continuationSeparator":[{"paragraphFormat":{"afterSpacing":0,"lineSpacing":1,"lineSpacingType":"Multiple","styleName":"Normal","listFormat":{}},"characterFormat":{"fontColor":"empty"},"inlines":[{"characterFormat":{"fontColor":"empty"},"text":"\\u0004"}]}],"continuationNotice":[{"paragraphFormat":{"listFormat":{}},"characterFormat":{},"inlines":[]}]}}';
}